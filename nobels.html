<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="UTF-8">
      <link rel="stylesheet" href="css/styles.css">
      <title>Nobel Prizewinner Database</title>
    </head>
  
    <body>
		
		<h1>Nobel Laureates Internet Database</h1>
		
		<h2>Please enter your search criteria below</h2>
		
		<form onsubmit="return false">
			<fieldset>
				<legend>Search Criteria</legend>
    			Start Year:<br>
    			<input type="text" id="startyear" required><br>
    			End Year:<br>
    			<input type="text" id="endyear" required><br>
				Categories:
				<select id ="categories" name="categories">
					<option value="all">-</option>
					<option value="physics">Physics</option>
					<option value="chemistry">Chemistry</option>
					<option value="medicine">Medicine</option>
					<option value="peace">Peace</option>
					<option value="economics">Economics</option>
				</select><br>
    			<input type="submit" value="Submit" onclick="displayResults()">
			</fieldset>
  		</form>
		
		<div id="laureatesTable"/>
      
        <footer> 
          <p>Made with <span aria-hidden="true">&hearts;</span> by Patrick Kennedy for UCD H.Dip Computer Science Web Application Development Assignment 2</p>
        </footer>
    
    <script>
    	var xmlhttp = new XMLHttpRequest();
        var url = "data.json";
        
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {

                //Parse the JSON data to a global JavaScript variable. 
                parsedObj = JSON.parse(xmlhttp.responseText);
            }
        };

        xmlhttp.open("GET", url, true);
        xmlhttp.send();
        
        function getLaureatesData(obj, startYear = "1901", endYear = "2018"){
			
        	var laureatesArray = obj.laureates;
			var startYearInt = parseInt(startYear);
			var endYearInt = parseInt(endYear);
			
			var matches = [];
			
			// We need to filter our results by year
			for(var i = 0; i < laureatesArray.length; i++){
				for(var j = 0; j < laureatesArray[i].prizes.length; j++){
					var prizeYearInt = parseInt(laureatesArray[i].prizes[j].year);
					if (prizeYearInt >= startYearInt && prizeYearInt <= endYearInt) {
						matches.push(laureatesArray[i]);
					}
				}
			};
									
			var laureatesInfo = "<table>";
			laureatesInfo += "<tr><th>Name</th><th>Category</th><th>Year of Award</th></tr>";
			
			for(var i = 0; i < matches.length; i++){
        		var firstname = matches[i].firstname;
        		var surname = matches[i].surname;
        		laureatesInfo += "<tr><td>" + firstname + " " + surname + "</td>";
				var prizeCategories = [];
				var prizeYears = [];
				for(var j = 0; j < matches[i].prizes.length; j++){
					prizeCategories.push(matches[i].prizes[j].category);
					prizeYears.push(matches[i].prizes[j].year);
				}
				laureatesInfo += "<td>" + prizeCategories.join(', ') + "</td>";
				laureatesInfo += "<td>" + prizeYears.join(', ') + "</td></tr>";
    		}

    		laureatesInfo += "</table>"
    		document.getElementById("laureatesTable").innerHTML = laureatesInfo;
			
        }
		
		function displayResults(){
			// Form parameters that will get passed to getLaureatesData.
			var startyear = document.getElementById("startyear").value;
			var endyear = document.getElementById("endyear").value;
			var prizeCategory = document.getElementById("categories").value;
			
			getLaureatesData(parsedObj, startyear, endyear);
			
		}
		
    </script>
      
    </body>
  
</html>